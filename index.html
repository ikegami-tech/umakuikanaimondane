<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥å ±ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        /* --- åŸºæœ¬ãƒªã‚»ãƒƒãƒˆ --- */
        * { box-sizing: border-box; }
        body { 
            font-family: sans-serif; margin: 0; padding: 0; 
            background-color: #e3f2fd; height: 100vh; display: flex; color: #333;
        }

        /* --- ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ç­‰ï¼‰ --- */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(51, 51, 51, 0.9); z-index: 9999;
            display: none; flex-direction: column; justify-content: center; align-items: center; color: white;
        }
        #login-overlay { display: flex; } 

        .auth-box {
            background: white; color: #333; padding: 30px; border-radius: 8px;
            text-align: center; width: 320px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .auth-box h2 { margin-top: 0; margin-bottom: 15px; font-size: 20px; }
        .auth-box input { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
        .auth-box button { width: 100%; padding: 10px; margin-top: 15px; border: none; border-radius: 4px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .btn-primary { background: #0288d1; color: white; } 
        .btn-primary:hover { background: #01579b; }
        .btn-secondary { background: #666; color: white; margin-top: 10px !important; }
        .auth-link { display: block; margin-top: 15px; color: #0288d1; text-decoration: underline; cursor: pointer; font-size: 14px; }
        .msg-area { color: red; margin-top: 10px; font-size: 14px; min-height: 20px; }

        /* --- ã‚¢ãƒ—ãƒªæœ¬ä½“ --- */
        .app-container { display: none; width: 100%; height: 100%; }
        
        /* --- ã‚µã‚¤ãƒ‰ãƒãƒ¼ --- */
        .sidebar {
            width: 220px; background-color: #0277bd; color: white; padding: 20px;
            display: flex; flex-direction: column; gap: 15px; flex-shrink: 0; transition: left 0.3s ease;
        }
        .sidebar h2 { font-size: 18px; text-align: center; margin-bottom: 10px; border-bottom: 1px solid #4fc3f7; padding-bottom: 10px; }
        .menu-btn {
            background: transparent; color: white; border: none; padding: 12px;
            text-align: left; cursor: pointer; border-radius: 4px; font-size: 14px; transition: 0.2s; width: 100%;
        }
        .menu-btn:hover, .menu-btn.active { background: #4fc3f7; color: #fff; }
        .menu-btn.logout { margin-top: auto; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.3); }

        .main-content {
            width: 100%; padding-top: 80px; padding-bottom: 30px; padding-left: 15px; padding-right: 15px;
            display: flex; flex-direction: column; align-items: center; overflow-y: auto; position: relative;
        }
        .main-content h1 { text-align: center !important; width: 100%; margin-bottom: 30px; margin-top: 0; color: #01579b; }
        .content-section { display: none; width: 100%; max-width: 800px; }
        .content-section.active { display: block; }

        /* --- ãƒ•ã‚©ãƒ¼ãƒ ãƒ»ã‚³ãƒ³ãƒ†ãƒŠ --- */
        .form-container, .manager-container { 
            background-color: #fff; border: 1px solid #b3e5fc; padding: 2rem; border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); max-width: 700px; margin: 0 auto; transition: border-color 0.3s;
        }
        .form-container.editing { border: 2px solid #007bff; background-color: #f8fbff !important; }
        .form-container.past-mode { border: 2px solid #ff4d4d; background-color: #fff5f5 !important; }

        .form-group { margin-bottom: 20px; display: flex; align-items: flex-start; }
        label { display: block; width: 150px; margin-right: 20px; padding-top: 10px; font-size: 16px; font-weight: bold; color: #333; border-left: 4px solid #0288d1; padding-left: 10px; }
        .input-wrapper { flex-grow: 1; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
        textarea { height: 100px; resize: vertical; }

        /* --- ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ --- */
        .condition-group { display: flex; flex-wrap: wrap; gap: 8px; padding-top: 5px; }
        .condition-label { border: 1px solid transparent; border-radius: 6px; padding: 5px 8px; font-size: 0.95rem; cursor: pointer; display: flex; align-items: center; }
        .condition-group .condition-label { width: calc(25% - 6px); justify-content: flex-start; }
        .condition-label:has(input[type="radio"]:checked) { border-color: #0288d1; background-color: #e1f5fe; font-weight: bold; }

        /* --- ãƒœã‚¿ãƒ³é¡ --- */
        .button-group { display: flex; justify-content: center; gap: 20px; margin-top: 30px; }
        button.send-btn { padding: 10px 30px; background: #0288d1; color: white; border: none; cursor: pointer; border-radius: 6px; font-size: 16px; font-weight: bold; }
        button.send-btn:hover { background: #01579b; }
        button.send-btn:disabled { background: #ccc; cursor: not-allowed; }
        button.send-btn.update-mode { background: #007bff; }
        #cancel-edit-btn { display: none; padding: 10px 30px; background: #999; color: white; border: none; cursor: pointer; border-radius: 6px; font-size: 16px; font-weight: bold; }
        .btn-copy { background: #fff; color: #28a745; border: 1px solid #28a745; font-weight: bold; padding: 5px 12px; border-radius: 20px; cursor: pointer; }

        /* --- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆå…±é€šï¼‰ --- */
        .calendar-container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid #ccc; }
        .calendar-title-area { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; background-color: #f0f8ff; padding: 10px; border-radius: 6px; }
        .calendar-btn { padding:5px 15px; cursor:pointer; background:#fff; border:1px solid #0288d1; color: #0288d1; border-radius:4px; font-weight:bold; }
        .calendar-btn:hover { background: #e1f5fe; }
        
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 10px; }
        .calendar-header { font-weight: bold; text-align: center; padding: 8px; background: #eee; border-radius: 4px; }
        .calendar-day { 
            border: 1px solid #ddd; height: 70px; padding: 5px; font-size: 14px; 
            cursor: pointer; display: flex; justify-content: center; align-items: center; 
            border-radius: 4px; transition: 0.1s; position: relative;
        }
        .calendar-day:hover { transform: scale(1.02); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        /* è‰²åˆ†ã‘ */
        .day-missing { background-color: #ffebee; color: #c62828; } /* æœªæå‡ºï¼ˆèµ¤ï¼‰ */
        .day-submitted { background-color: #e8f5e9; color: #2e7d32; border: 2px solid #81c784; } /* æå‡ºæ¸ˆï¼ˆç·‘ï¼‰ */
        .day-holiday { background-color: #e1f5fe; color: #0277bd; font-weight: bold; } /* ä¼‘ã¿ï¼ˆé’ï¼‰ */
        .day-future { background-color: #f5f5f5; color: #ccc; cursor: default; }
        
        .legend-area { margin-top: 15px; text-align: right; font-size: 12px; }
        .legend-box { display:inline-block; width:12px; height:12px; margin-left:10px; vertical-align: middle; }

        /* --- ãƒªã‚¹ãƒˆãƒ»å±¥æ­´ --- */
        .list-header { background-color: #f8fbff; padding: 20px; border-radius: 8px; border: 1px solid #b3e5fc; margin-bottom: 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .list-header h2 { margin-top: 0; margin-bottom: 15px; font-size: 1.2rem; color: #0277bd; border-bottom: 1px dashed #b3e5fc; padding-bottom: 10px; }
        .filter-area { display: flex; gap: 10px; }
        .filter-select, .filter-input { padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
        .filter-select { width: 30%; } .filter-input { width: 70%; } 
        
        .item { position: relative; background-color: #fff; border: 1px solid #ccc; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .report-header-area { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #eee; }
        .report-label { font-weight: bold; font-size: 0.95rem; color: #333; background-color: #f0f0f0; padding: 4px 10px; border-radius: 4px; display: inline-block; margin-bottom: 8px; }
        .report-content { font-size: 1rem; line-height: 1.6; color: #222; padding-left: 5px; white-space: pre-wrap; margin-bottom: 20px; }
        .card-footer { margin-top: 20px; padding-top: 15px; border-top: 1px dashed #e0e0e0; display: flex; justify-content: flex-end; align-items: center; flex-wrap: wrap; gap: 10px; }
        .like-buttons { display: flex; gap: 5px; }
        .like-btn { font-size: 11px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 15px; background-color: #fff; cursor: pointer; }
        .like-btn:hover { background-color: #e1f5fe; border-color: #0288d1; }
        .like-btn:disabled { background-color: #f5f5f5; color: #aaa; border-color: #ddd; cursor: not-allowed; }
        .delete-btn { position: absolute; top: -10px; left: -10px; width: 30px; height: 30px; background: #ff4d4d; color: white; border-radius: 50%; border: none; font-weight: bold; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .edit-btn { padding: 6px 15px; background: #fff; color: #007bff; border: 1px solid #007bff; border-radius: 20px; font-size: 12px; cursor: pointer; }

        /* ãã®ä»– */
        .Pagination { display: flex; justify-content: center; margin: 40px 0; gap: 10px; }
        .Pagination-Item-Link { width: 35px; height: 35px; display: flex; justify-content: center; align-items: center; border: 1px solid #ccc; cursor: pointer; text-decoration: none; color: #333; background: #fff; }
        .Pagination-Item-Link.isActive { background: #0288d1; color: white; border-color: #0288d1; pointer-events: none; }
        .date-alert-box { background-color: #ff4d4d; color: white; padding: 10px; border-radius: 4px; margin-bottom: 20px; display: none; justify-content: space-between; align-items: center; }
        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 4px; padding: 16px; position: fixed; z-index: 200; right: 30px; bottom: 30px; font-size: 16px; opacity: 0; transition: opacity 0.5s, bottom 0.5s; }
        #toast.show { visibility: visible; opacity: 1; bottom: 50px; }

        /* ã‚¹ãƒãƒ›ç”¨ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ */
        .hamburger { display: none; }
        @media (max-width: 768px) {
            body, .app-container { flex-direction: column; height: auto; min-height: 100vh; }
            .sidebar { position: fixed; top: 0; left: -250px; width: 250px; height: 100%; padding-top: 60px; z-index: 1000; box-shadow: 2px 0 10px rgba(0,0,0,0.2); }
            .sidebar.active { left: 0; }
            .hamburger { display: flex; justify-content: center; align-items: center; position: fixed; top: 15px; left: 15px; width: 50px; height: 50px; border-radius: 50%; z-index: 2000; background-color: #0277bd; color: white; border: none; font-size: 24px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
            .form-group { flex-direction: column; }
            label { width: 100%; border-bottom: 2px solid #81d4fa; border-left: none; margin-bottom: 5px; padding-left: 0; }
            .button-group { flex-direction: column-reverse; gap: 10px; }
            button { width: 100%; padding: 12px; }
            .condition-group .condition-label { width: calc(50% - 6px); }
            .filter-area { flex-direction: column; }
            .filter-select, .filter-input { width: 100%; }
        }
    </style>
</head>
<body>

    <div id="login-overlay" class="overlay">
        <div class="auth-box">
            <h2>ğŸ”‘ ãƒ­ã‚°ã‚¤ãƒ³</h2>
            <input type="text" id="login-id" placeholder="ãƒ­ã‚°ã‚¤ãƒ³ID" oninput="value = value.replace(/[^a-zA-Z0-9.]/g, '');">
            <input type="password" id="login-password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" onkeydown="if(event.key==='Enter') tryLogin()">
            <button onclick="tryLogin()" class="btn-primary" id="login-btn">ãƒ­ã‚°ã‚¤ãƒ³</button>
            <div class="msg-area" id="login-msg"></div>
            <a class="auth-link" onclick="showRegister()">æ–°è¦ç™»éŒ²ã®æ–¹ã¯ã“ã¡ã‚‰</a>
            <a class="auth-link" onclick="showReset()">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ãŸã„æ–¹ã¯ã“ã¡ã‚‰</a>
        </div>
    </div>

    <div id="register-overlay" class="overlay">
        <div class="auth-box">
            <h2>ğŸ“ æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²</h2>
            <input type="text" id="reg-id" placeholder="ãƒ­ã‚°ã‚¤ãƒ³IDï¼ˆåŠè§’è‹±æ•°ï¼‰" oninput="value = value.replace(/[^a-zA-Z0-9.]/g, '');">
            <input type="text" id="reg-name" placeholder="ãŠåå‰">
            <input type="email" id="reg-email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹">
            <input type="password" id="reg-pass" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
            <button onclick="tryRegister()" class="btn-primary" id="reg-btn">ç™»éŒ²ã™ã‚‹</button>
            <button onclick="showLogin()" class="btn-secondary">æˆ»ã‚‹</button>
            <div class="msg-area" id="reg-msg"></div>
        </div>
    </div>

    <div id="reset-overlay" class="overlay">
        <div class="auth-box">
            <h2>ğŸ”’ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ</h2>
            <p style="text-align:left;">ç™»éŒ²ã—ãŸIDã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br>ä»®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã¾ã™ã€‚</p>
            <input type="text" id="reset-id" placeholder="ãƒ­ã‚°ã‚¤ãƒ³ID">
            <input type="email" id="reset-email" placeholder="ç™»éŒ²ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹">
            <button onclick="tryReset()" class="btn-primary" id="reset-btn">é€ä¿¡ã™ã‚‹</button>
            <button onclick="showLogin()" class="btn-secondary">æˆ»ã‚‹</button>
            <div class="msg-area" id="reset-msg"></div>
        </div>
    </div>

    <button class="hamburger" onclick="toggleMenu()">â˜°</button>

    <div class="app-container" id="app-container">
        <div class="sidebar">
            <h2>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
            <button class="menu-btn" onclick="switchTab('input')">ğŸ“ æ—¥å ±å…¥åŠ›</button>
            <button class="menu-btn" onclick="switchTab('check-report')">ğŸ“… æ—¥å ±ç¢ºèªãƒ»ä¿®æ­£</button>
            <button class="menu-btn" onclick="switchTab('holiday-setting')">ğŸ–ï¸ ä¼‘ã¿ä¸€æ‹¬ç™»éŒ²</button>
            <button class="menu-btn" onclick="switchTab('history')">ğŸ“‚ éå»ã®å ±å‘Š</button>
            <button class="menu-btn" onclick="switchTab('member')">ğŸ‘¥ ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†</button>
            <button class="menu-btn" onclick="switchTab('password')">ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´</button>
            <button class="menu-btn logout" onclick="logout()">ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>

        <div class="main-content">
            
            <div id="tab-member" class="content-section">
                <h1>ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†</h1>
                <div class="manager-container">
                    <div class="member-header">
                        <h3 style="margin:0;">ç¾åœ¨ã®ãƒ¡ãƒ³ãƒãƒ¼</h3>
                        <button id="delete-member-btn" class="btn-sm btn-delete-member" onclick="deleteMember()">é¸æŠã—ãŸãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤</button>
                    </div>
                    <p style="margin-bottom:15px; color:#666; font-size:14px;">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã™ã‚‹ã¨è‡ªå‹•ã§ã“ã“ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚</p>
                    <div id="manage-member-radios" class="condition-group">èª­ã¿è¾¼ã¿ä¸­...</div>
                </div>
            </div>

            <div id="tab-input" class="content-section active">
                <h1 id="page-title">ã‚·ã‚¹ãƒ†ãƒ èª²æ—¥å ±</h1>
                <div class="form-container" id="form-container">
                    <div id="date-alert" class="date-alert-box">
                        <span id="date-alert-text"></span>
                        <button onclick="resetDate()" style="background:white; color:#ff4d4d; border:none; border-radius:4px; cursor:pointer; padding:2px 8px; font-weight:bold;">ä»Šæ—¥ã«æˆ»ã™</button>
                    </div>
                    <div class="form-group">
                        <label>æ—¥ä»˜</label>
                        <div class="input-wrapper"><input type="date" id="report-date"></div>
                    </div>
                    <div class="form-group" style="display:none;">
                        <label>åå‰</label>
                        <div class="input-wrapper"><div id="name-radios" class="condition-group"></div></div>
                    </div>
                    <div class="form-group">
                        <label>ä½“èª¿</label>
                        <div class="input-wrapper condition-group">
                            <label class="condition-label"><input type="radio" name="condition" value="ğŸ˜„ çµ¶å¥½èª¿" onclick="toggleRadio(this, 'condition')">ğŸ˜„ çµ¶å¥½èª¿</label>
                            <label class="condition-label"><input type="radio" name="condition" value="ğŸ‘ è‰¯ã„" onclick="toggleRadio(this, 'condition')">ğŸ‘ è‰¯ã„</label>
                            <label class="condition-label"><input type="radio" name="condition" value="ğŸ˜Š æ™®é€š" onclick="toggleRadio(this, 'condition')">ğŸ˜Š æ™®é€š</label>
                            <label class="condition-label"><input type="radio" name="condition" value="ğŸ¤” è€ƒãˆä¸­" onclick="toggleRadio(this, 'condition')">ğŸ¤” è€ƒãˆä¸­</label>
                            <label class="condition-label"><input type="radio" name="condition" value="ğŸ˜‡ ä¸èª¿" onclick="toggleRadio(this, 'condition')">ğŸ˜‡ ä¸èª¿</label>
                            <label class="condition-label"><input type="radio" name="condition" value="ğŸ«  ç–²åŠ´" onclick="toggleRadio(this, 'condition')">ğŸ«  ç–²åŠ´</label>
                            <label class="condition-label"><input type="radio" name="condition" value="ğŸ¤¢ äºŒæ—¥é…”ã„" onclick="toggleRadio(this, 'condition')">ğŸ¤¢ äºŒæ—¥é…”ã„</label>
                            <label class="condition-label"><input type="radio" name="condition" value="ğŸ«¨ é©šã" onclick="toggleRadio(this, 'condition')">ğŸ«¨ é©šã</label>
                            <label class="condition-label"><input type="radio" name="condition" value="ğŸ‰ é”æˆæ„Ÿ" onclick="toggleRadio(this, 'condition')">ğŸ‰ é”æˆæ„Ÿ</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; flex-direction: column; gap: 8px;">
                            <span>ä»Šæ—¥ã®é€²æ—çŠ¶æ³</span>
                            <button type="button" class="btn-copy" onclick="copyLastTomorrow()" style="margin: 0; width: 100%; text-align: center; font-size: 11px;">å‰å›ã®ã‚³ãƒ”ãƒ¼</button>
                        </label>
                        <div class="input-wrapper"><textarea id="progress" placeholder="æœ¬æ—¥ã®æ¥­å‹™å†…å®¹ã¨é€²æ—åº¦åˆã‚’è¨˜å…¥ã—ã¦ãã ã•ã„"></textarea></div>
                    </div>
                    <div class="form-group">
                        <label for="tomorrow">æ˜æ—¥ã®æ¥­å‹™å†…å®¹</label>
                        <div class="input-wrapper"><textarea id="tomorrow" placeholder="æ˜æ—¥å®Ÿæ–½äºˆå®šã®æ¥­å‹™ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„"></textarea></div>
                    </div>
                    <div class="form-group">
                        <label for="comment">æ‰€è¦‹ã‚„æ„Ÿã˜ãŸã“ã¨</label>
                        <div class="input-wrapper"><textarea id="comment" placeholder="æ¥­å‹™ã‚’é€šã—ã¦æ„Ÿã˜ãŸã“ã¨ã€æ‰€è¦‹ã€èª²é¡Œãªã©ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„"></textarea></div>
                    </div>
                    <div class="form-group">
                        <label>è³‡æ–™æ·»ä»˜</label>
                        <div class="input-wrapper">
                            <input type="file" id="file-attach">
                            <div id="current-file-msg" style="font-size:12px; color:blue; display:none;">â€»æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ·»ä»˜ã™ã‚‹ã¨ä¸Šæ›¸ãã•ã‚Œã¾ã™</div>
                        </div>
                    </div>
                    <div class="button-group">
                        <button id="cancel-edit-btn" onclick="cancelEdit()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        <button id="submit-btn" onclick="sendData()" class="send-btn">é€ä¿¡</button>
                    </div>
                </div>      
            </div>

            <div id="tab-check-report" class="content-section">
                <h1>ğŸ“… æ—¥å ±ç¢ºèªãƒ»ä¿®æ­£</h1>
                <div class="calendar-container">
                    <p>æ—¥ä»˜ã‚’é¸æŠã™ã‚‹ã¨ã€ãã®æ—¥ã®æ—¥å ±ã‚’ç¢ºèªãƒ»ä¿®æ­£ã§ãã¾ã™ã€‚</p>
                    <div id="report-cal-area"></div>
                    <div class="legend-area">
                        <span class="legend-box" style="background:#e8f5e9; border:1px solid #81c784;"></span> æå‡ºæ¸ˆ
                        <span class="legend-box" style="background:#ffebee;"></span> æœªæå‡º
                        <span class="legend-box" style="background:#e1f5fe;"></span> ä¼‘æ—¥
                    </div>
                </div>
            </div>

            <div id="tab-holiday-setting" class="content-section">
                <h1>ğŸ–ï¸ ä¼‘ã¿ä¸€æ‹¬ç™»éŒ²</h1>
                <div class="calendar-container">
                    <p>æ—¥ä»˜ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€Œä¼‘ã¿ã€ã®ç™»éŒ²ãƒ»è§£é™¤ãŒã§ãã¾ã™ã€‚</p>
                    <div id="holiday-cal-area"></div>
                    <div class="legend-area">
                        <span class="legend-box" style="background:#e1f5fe; color:#0277bd;"></span> ä¼‘ã¿è¨­å®šä¸­
                        <span class="legend-box" style="background:#fff; border:1px solid #ddd;"></span> å‡ºå‹¤æ—¥
                    </div>
                </div>
            </div>

            <div id="tab-history" class="content-section">
                <div id="data-list">
                    <div class="list-header">
                        <h2>éå»ã®å ±å‘Šä¸€è¦§</h2>
                        <div class="filter-area">
                            <select id="filter-name" class="filter-select" onchange="applyFilter()"><option value="">å…¨å“¡</option></select>
                            <input type="text" id="filter-text" class="filter-input" placeholder="æ¤œç´¢..." oninput="applyFilter()">
                        </div>
                    </div>
                    <div id="report-container">èª­ã¿è¾¼ã¿ä¸­...</div>
                </div>
            </div>

            <div id="tab-password" class="content-section">
                <h1>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´</h1>
                <div class="manager-container">
                    <p style="margin-bottom:20px;">æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¾ã™ã€‚</p>
                    <div class="form-group"><label>ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label><div class="input-wrapper"><input type="password" id="cp-current"></div></div>
                    <div class="form-group"><label>æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label><div class="input-wrapper"><input type="password" id="cp-new"></div></div>
                    <div class="form-group"><label>ç¢ºèªå…¥åŠ›</label><div class="input-wrapper"><input type="password" id="cp-confirm"></div></div>
                    <div class="button-group"><button onclick="changePassword()" class="send-btn">å¤‰æ›´ã™ã‚‹</button></div>
                    <p id="cp-msg" style="color:red; text-align:center; margin-top:15px;"></p>
                </div>
            </div>

        </div>
    </div>

    <div id="toast">é€ä¿¡å®Œäº†ã—ã¾ã—ãŸï¼</div>

    <script>
        // â˜…é‡è¦ï¼šã‚ãªãŸã®GAS URL
        const GAS_URL = "https://script.google.com/macros/s/AKfycbyDvA1WA7D_EQRmD_nYrtD-3RWWm2sT3hASH9luQGxJ_OXm4zhOwqPe1OU0oows0W0lPQ/exec"; 

        // --- èªè¨¼ç³» ---
        function showLogin() { document.querySelectorAll('.overlay').forEach(el => el.style.display = 'none'); document.getElementById('login-overlay').style.display = 'flex'; }
        function showRegister() { document.querySelectorAll('.overlay').forEach(el => el.style.display = 'none'); document.getElementById('register-overlay').style.display = 'flex'; }
        function showReset() { document.querySelectorAll('.overlay').forEach(el => el.style.display = 'none'); document.getElementById('reset-overlay').style.display = 'flex'; }

        function tryRegister() {
            const id = document.getElementById('reg-id').value; const name = document.getElementById('reg-name').value; const email = document.getElementById('reg-email').value; const pass = document.getElementById('reg-pass').value;
            if(!id || !name || !email || !pass) { alert("ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
            document.getElementById('reg-btn').disabled = true;
            fetch(GAS_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ action: 'register', id: id, name: name, email: email, password: pass }) }).then(() => { alert("ç™»éŒ²ã—ã¾ã—ãŸï¼"); location.reload(); });
        }
        function tryReset() {
            const id = document.getElementById('reset-id').value; const email = document.getElementById('reset-email').value;
            if(!id || !email) { alert("é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
            fetch(GAS_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ action: 'resetPassword', id: id, email: email }) }).then(() => { alert("é€ä¿¡ã—ã¾ã—ãŸ"); showLogin(); });
        }
        function changePassword() {
            const currentPass = document.getElementById('cp-current').value; const newPass = document.getElementById('cp-new').value; const confirmPass = document.getElementById('cp-confirm').value; const myId = localStorage.getItem('login_user_id'); 
            if (!currentPass || !newPass) { alert("é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
            if (newPass !== confirmPass) { alert("æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“"); return; }
            fetch(GAS_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ action: 'changePassword', id: myId, currentPass: currentPass, newPass: newPass }) }).then(() => { alert("å¤‰æ›´ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸ"); });
        }
        function logout() {
            if(!confirm("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ")) return;
            localStorage.clear(); location.reload();
        }

        // --- ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ---
        let allData = [], currentData = [], memberList = [], holidayList = []; 
        let loggedInUser = null;
        const ITEMS_PER_PAGE = 10; let currentPage = 1;
        let isEditing = false, editingRowIndex = null, currentEditingFileUrl = "", targetReportDate = null;
        let saveTimers = {}, lastSelection = { name: null, condition: null };
        
        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºç”¨ã‚¹ãƒ†ãƒ¼ãƒˆ
        let displayYear = new Date().getFullYear();
        let displayMonth = new Date().getMonth();
        let currentCalendarMode = 'report'; // 'report' or 'holiday'

        // --- åˆæœŸåŒ– ---
        window.onload = function() { 
            const savedId = localStorage.getItem('login_user_id'); const savedName = localStorage.getItem('login_user_name');
            if (savedId && savedName) {
                loggedInUser = savedName;
                document.querySelectorAll('.overlay').forEach(el => el.style.display = 'none'); 
                document.getElementById('app-container').style.display = 'flex'; 
                fetchData();
                setTodayDate();
            }
        };

        function tryLogin() {
            const id = document.getElementById('login-id').value; const pass = document.getElementById('login-password').value;
            if(!id || !pass) return;
            fetch(GAS_URL + '?action=login&id=' + encodeURIComponent(id) + '&password=' + encodeURIComponent(pass))
            .then(res => res.json()).then(data => {
                if (data.auth) {
                    localStorage.setItem('login_user_id', id); localStorage.setItem('login_user_name', data.name); localStorage.setItem('login_time', new Date().getTime());
                    location.reload();
                } else { document.getElementById('login-msg').innerText = data.message; }
            });
        }

        // --- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ ---
        function switchTab(tabName) {
            document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.menu-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.add('active');
            
            // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹æ›´æ–°
            const btns = document.querySelectorAll('.menu-btn');
            const map = {'input':0, 'check-report':1, 'holiday-setting':2, 'history':3, 'member':4, 'password':5};
            if(map[tabName] !== undefined) btns[map[tabName]].classList.add('active');

            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¿ãƒ–ã®å ´åˆã®åˆæœŸåŒ–
            if (tabName === 'check-report') {
                currentCalendarMode = 'report';
                resetCalendarView();
            } else if (tabName === 'holiday-setting') {
                currentCalendarMode = 'holiday';
                resetCalendarView();
            }
        }

        function resetCalendarView() {
            const now = new Date();
            displayYear = now.getFullYear();
            displayMonth = now.getMonth();
            renderCalendar();
        }

        // --- ãƒ‡ãƒ¼ã‚¿å–å¾— ---
        function fetchData() {
            fetch(GAS_URL + '?t=' + new Date().getTime()).then(res => res.json()).then(data => {
                if (data.members) { memberList = data.members; renderMemberRadios(); renderFilterOptions(); }
                if (data.holidays) { holidayList = data.holidays; } 
                allData = (data.reports || []).reverse(); 
                currentData = allData;
                
                // ãƒ‡ãƒ¼ã‚¿å–å¾—å¾Œã«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’å†æç”»ï¼ˆã‚‚ã—è¡¨ç¤ºä¸­ãªã‚‰ï¼‰
                if(document.getElementById('tab-check-report').classList.contains('active') || document.getElementById('tab-holiday-setting').classList.contains('active')) {
                    renderCalendar();
                }
                renderPage(1);
            });
        }

        // --- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ­ã‚¸ãƒƒã‚¯ ---
        function changeMonth(diff) {
            displayMonth += diff;
            if (displayMonth > 11) { displayMonth = 0; displayYear++; }
            else if (displayMonth < 0) { displayMonth = 11; displayYear--; }
            renderCalendar();
        }

        function renderCalendar() {
            if (!loggedInUser) return;
            
            // æç”»å…ˆã¨ãƒ¢ãƒ¼ãƒ‰ã®æ±ºå®š
            let containerId = (currentCalendarMode === 'report') ? 'report-cal-area' : 'holiday-cal-area';
            const container = document.getElementById(containerId);
            container.innerHTML = "";

            const year = displayYear;
            const month = displayMonth;
            const lastDay = new Date(year, month + 1, 0).getDate();
            const firstDayOfWeek = new Date(year, month, 1).getDay();
            const nowObj = new Date();
            const todayYear = nowObj.getFullYear(); const todayMonth = nowObj.getMonth(); const todayDate = nowObj.getDate();

            // æå‡ºæ¸ˆã¿ãƒªã‚¹ãƒˆ
            const submittedDates = allData.filter(row => row[1] === loggedInUser).map(row => { 
                const d = new Date(row[0]); return `${d.getFullYear()}-${d.getMonth()}-${d.getDate()}`; 
            });

            // HTMLçµ„ã¿ç«‹ã¦
            const titleHtml = `
                <div class="calendar-title-area">
                    <button class="calendar-btn" onclick="changeMonth(-1)">â—€ å‰æœˆ</button>
                    <h3 style="margin:0;">${year}å¹´ ${month + 1}æœˆ</h3>
                    <button class="calendar-btn" onclick="changeMonth(1)">ç¿Œæœˆ â–¶</button>
                </div>
            `;
            const gridHeaderHtml = `
                <div class="calendar-header">æ—¥</div><div class="calendar-header">æœˆ</div><div class="calendar-header">ç«</div>
                <div class="calendar-header">æ°´</div><div class="calendar-header">æœ¨</div><div class="calendar-header">é‡‘</div><div class="calendar-header">åœŸ</div>
            `;
            
            let gridBodyHtml = ""; 
            for (let i = 0; i < firstDayOfWeek; i++) { gridBodyHtml += `<div class="calendar-day" style="background:#f9f9f9; cursor:default;"></div>`; }
            
            for (let d = 1; d <= lastDay; d++) {
                const checkDateStr = `${year}-${month}-${d}`; 
                let className = "day-missing"; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆèµ¤
                let content = `${d}`;

                const isHoliday = holidayList.some(h => {
                    const hDate = new Date(h[0]);
                    return hDate.getFullYear() === year && hDate.getMonth() === month && hDate.getDate() === d && h[1] === loggedInUser;
                });

                // æœªæ¥åˆ¤å®š
                let isFuture = false;
                if (year > todayYear) isFuture = true;
                else if (year === todayYear && month > todayMonth) isFuture = true;
                else if (year === todayYear && month === todayMonth && d > todayDate) isFuture = true;

                // ãƒ¢ãƒ¼ãƒ‰ã”ã¨ã®è‰²ä»˜ã‘
                if (currentCalendarMode === 'holiday') {
                    // ä¼‘ã¿ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰
                    if (isHoliday) { className = "day-holiday"; content += "<br><span style='font-size:10px'>ä¼‘ã¿</span>"; }
                    else { className = "day-submitted"; } // ç™½ï¼ˆå‡ºå‹¤ï¼‰
                } else {
                    // æ—¥å ±ç¢ºèªãƒ¢ãƒ¼ãƒ‰
                    if (submittedDates.includes(checkDateStr)) { className = "day-submitted"; }
                    else if (isHoliday) { className = "day-holiday"; }
                    else if (isFuture) { className = "day-future"; }
                }

                const clickEvent = `onclick="handleDateClick(${year}, ${month}, ${d})"`;
                gridBodyHtml += `<div class="calendar-day ${className}" ${clickEvent}>${content}</div>`;
            }
            
            container.innerHTML = titleHtml + '<div class="calendar-grid">' + gridHeaderHtml + gridBodyHtml + '</div>';
        }

        function handleDateClick(year, month, day) {
            if (currentCalendarMode === 'holiday') {
                // ä¼‘ã¿ä¸€æ‹¬ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ï¼šã‚¿ãƒƒãƒ—ã§å³ãƒˆã‚°ãƒ«
                toggleHoliday(year, month, day);
            } else {
                // æ—¥å ±ç¢ºèªãƒ¢ãƒ¼ãƒ‰ï¼šæœªæ¥ã¯ãƒ–ãƒ­ãƒƒã‚¯ã€éå»ã¯ç·¨é›†ã¸
                const now = new Date();
                if (new Date(year, month, day) > now) { alert("æœªæ¥ã®æ—¥å ±ã¯ä½œæˆã§ãã¾ã›ã‚“"); return; }
                startReportForDate(year, month, day);
            }
        }

        function toggleHoliday(year, month, day) {
            // ç´ æ—©ã„åå¿œã®ãŸã‚ã«ã€ã‚µãƒ¼ãƒãƒ¼é€šä¿¡å‰ã«UIã‚’æ›´æ–°ã™ã‚‹ï¼ˆOptimistic UIï¼‰
            const dateStrISO = `${year}-${('0'+(month+1)).slice(-2)}-${('0'+day).slice(-2)}`;
            const checkDateStr = `${year}-${month}-${day}`;
            
            // é…åˆ—ã‚’ä»®æ›´æ–°
            const existingIdx = holidayList.findIndex(h => {
                const hDate = new Date(h[0]);
                return hDate.getFullYear() === year && hDate.getMonth() === month && hDate.getDate() === day && h[1] === loggedInUser;
            });

            if (existingIdx !== -1) { holidayList.splice(existingIdx, 1); } // å‰Šé™¤
            else { holidayList.push([dateStrISO, loggedInUser]); } // è¿½åŠ 
            
            renderCalendar(); // å†æç”»

            // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§é€ä¿¡
            const data = { action: 'manageHoliday', date: dateStrISO, name: loggedInUser };
            fetch(GAS_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) })
            .catch(err => console.error("Holiday Update Error"));
        }

        // --- æ—¥å ±ä½œæˆãƒ»ç·¨é›†ã¸ã®é·ç§» ---
        function startReportForDate(year, month, day) {
            const mm = ('0' + (month + 1)).slice(-2); const dd = ('0' + day).slice(-2);
            document.getElementById('report-date').value = `${year}-${mm}-${dd}`;
            targetReportDate = `${year}/${month + 1}/${day}`; 
            
            // åå‰ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚’è‡ªåˆ†ã«ã‚»ãƒƒãƒˆ
            const nameRadios = document.querySelectorAll('#name-radios input[name="name"]');
            nameRadios.forEach(r => { r.checked = (r.value === loggedInUser); });
            
            switchTab('input');
            document.getElementById('date-alert').style.display = 'flex'; 
            document.getElementById('date-alert-text').innerText = `${targetReportDate} ã®æ—¥å ±ã‚’ä½œæˆä¸­`; 
            document.getElementById('form-container').classList.add('past-mode');
            
            // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°ã‚»ãƒƒãƒˆï¼ˆç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼‰
            const targetRow = allData.find(row => {
                const d = new Date(row[0]);
                return row[1] === loggedInUser && d.getFullYear()===year && d.getMonth()===month && d.getDate()===day;
            });
            
            if (targetRow) {
                // æ—¢å­˜ã®editReportãƒ­ã‚¸ãƒƒã‚¯ã‚’æµç”¨ã—ãŸã„ãŒã€rowIDãŒå¿…è¦
                const rowIndex = targetRow[targetRow.length - 1];
                editReport(rowIndex);
            } else {
                // æ–°è¦
                document.getElementById('progress').value = "";
                document.getElementById('tomorrow').value = "";
                document.getElementById('comment').value = "";
                isEditing = false;
                document.getElementById('submit-btn').innerText = "é€ä¿¡";
                document.getElementById('form-container').classList.remove('editing');
            }
        }

        // --- ãã®ä»–ã®æ©Ÿèƒ½ï¼ˆæ—¢å­˜ç¶­æŒï¼‰ ---
        function setTodayDate() { 
            const today = new Date(); 
            document.getElementById('report-date').value = `${today.getFullYear()}-${('0'+(today.getMonth()+1)).slice(-2)}-${('0'+today.getDate()).slice(-2)}`; 
        }
        function resetDate() { 
            targetReportDate = null; 
            document.getElementById('date-alert').style.display = 'none'; 
            document.getElementById('form-container').classList.remove('past-mode'); 
            setTodayDate(); 
            cancelEdit();
        }
        
        // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ãªã©
        function renderMemberRadios() {
            const container = document.getElementById('name-radios'); container.innerHTML = "";
            const manageContainer = document.getElementById('manage-member-radios'); manageContainer.innerHTML = "";
            memberList.forEach(name => {
                const l1 = document.createElement('label'); l1.className = 'condition-label'; 
                l1.innerHTML = `<input type="radio" name="name" value="${name}" onclick="toggleRadio(this,'name')">${name}`;
                container.appendChild(l1);
                
                const l2 = document.createElement('label'); l2.className = 'condition-label'; 
                l2.innerHTML = `<input type="radio" name="manager-name" value="${name}" onchange="updateManagerButtonState()">${name}`;
                manageContainer.appendChild(l2);
            });
            // ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠ
            if(loggedInUser) {
                const r = container.querySelector(`input[value="${loggedInUser}"]`);
                if(r) r.checked = true;
            }
        }
        
        function toggleRadio(radio, type) { lastSelection[type] = radio.value; }
        function cancelEdit() { 
            isEditing = false; editingRowIndex = null; currentEditingFileUrl = ""; 
            document.getElementById('page-title').innerText = "ã‚·ã‚¹ãƒ†ãƒ èª²æ—¥å ±"; 
            const btn = document.getElementById('submit-btn'); btn.innerText = "é€ä¿¡"; btn.classList.remove('update-mode'); 
            document.getElementById('cancel-edit-btn').style.display = 'none'; 
            document.getElementById('form-container').classList.remove('editing'); 
            document.getElementById('current-file-msg').style.display = 'none'; 
        }
        
        async function sendData() {
            const dateVal = document.getElementById('report-date').value; 
            // åå‰ã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºå®šã€ã¾ãŸã¯ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‹ã‚‰å–å¾—
            let name = loggedInUser;
            const r = document.querySelector('#name-radios input:checked');
            if(r) name = r.value;

            const condition = document.querySelector('input[name="condition"]:checked')?.value; 
            const progress = document.getElementById('progress').value; 
            const tomorrow = document.getElementById('tomorrow').value; 
            const comment = document.getElementById('comment').value;
            
            if(!name || !condition || !progress || !tomorrow || !comment) { alert("å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
            
            const btn = document.getElementById('submit-btn'); btn.disabled = true; btn.innerText = "é€ä¿¡ä¸­...";
            let data = { targetDate: dateVal, name: name, condition: condition, progress: progress, tomorrow: tomorrow, comment: comment };
            if (isEditing) { data.action = 'edit'; data.rowIndex = editingRowIndex; data.currentFileUrl = currentEditingFileUrl; } else { data.action = 'report'; }
            
            const fileInput = document.getElementById('file-attach');
            if (fileInput.files.length > 0) {
                try { data.fileData = await readFileAsBase64(fileInput.files[0]); data.fileName = fileInput.files[0].name; data.mimeType = fileInput.files[0].type; } 
                catch (e) { alert("ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼"); btn.disabled = false; return; }
            }
            fetch(GAS_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) }).then(() => { 
                document.getElementById("toast").innerText = isEditing ? "ä¿®æ­£ã—ã¾ã—ãŸ" : "é€ä¿¡ã—ã¾ã—ãŸ"; showToast(); 
                resetForm(); fetchData(); btn.disabled = false; btn.innerText = "é€ä¿¡"; 
            });
        }
        function readFileAsBase64(file) { return new Promise((res, rej) => { const r = new FileReader(); r.onload = () => res(r.result.split(',')[1]); r.onerror = rej; r.readAsDataURL(file); }); }
        function resetForm() {
            document.querySelectorAll('input[name="condition"]').forEach(r => r.checked = false);
            document.getElementById('progress').value = ""; document.getElementById('tomorrow').value = ""; document.getElementById('comment').value = ""; document.getElementById('file-attach').value = "";
            setTodayDate(); cancelEdit();
        }
        function showToast() { var x = document.getElementById("toast"); x.className = "show"; setTimeout(()=>{ x.className = x.className.replace("show", ""); }, 2500); }
        function copyLastTomorrow() { alert("æœªå®Ÿè£…ï¼ˆæ©Ÿèƒ½çœç•¥ï¼‰"); } // ç°¡ç•¥åŒ–ã®ãŸã‚
        
        function renderFilterOptions() { const s = document.getElementById('filter-name'); s.innerHTML = '<option value="">å…¨å“¡</option>'; memberList.forEach(n => { s.innerHTML += `<option value="${n}">${n}</option>`; }); }
        function applyFilter() { 
            const n = document.getElementById('filter-name').value; const t = document.getElementById('filter-text').value.toLowerCase(); 
            currentData = allData.filter(r => { return (n===""||r[1]===n) && (t===""||(r[3]+r[4]+r[5]).toLowerCase().includes(t)); }); 
            renderPage(1); 
        }
        function renderPage(p) { 
            currentPage = p; const c = document.getElementById('report-container'); c.innerHTML = ""; 
            if(currentData.length===0) { c.innerHTML="<p>ãªã—</p>"; return; }
            currentData.slice((p-1)*ITEMS_PER_PAGE, p*ITEMS_PER_PAGE).forEach(row => createReportItem(row));
            renderPagination();
        }
        function createReportItem(row) {
            const date = new Date(row[0]).toLocaleDateString(); const name = row[1]; const cond = row[2]; const prog = row[3]; const tom = row[4]; const comm = row[5]; const rowId = row[row.length-1];
            const div = document.createElement('div'); div.className = 'item';
            div.innerHTML = `<div class="report-header-area"><b>${name}</b> ${cond} (${date})</div><div><b>é€²æ—:</b> ${prog}</div><div><b>æ˜æ—¥:</b> ${tom}</div><div><b>æ‰€è¦‹:</b> ${comm}</div>
            <div class="card-footer"><button class="edit-btn" onclick="editReport(${rowId})">ç·¨é›†</button></div>`;
            document.getElementById('report-container').appendChild(div);
        }
        function renderPagination() { /* çœç•¥ï¼ˆæ—¢å­˜ã®ã¾ã¾ï¼‰ */ }
        function updateManagerButtonState() { const v = document.querySelector('input[name="manager-name"]:checked'); document.getElementById('delete-member-btn').style.display = v ? 'block' : 'none'; }
        function deleteMember() {
             const name = document.querySelector('input[name="manager-name"]:checked')?.value;
             if(name && confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
                 fetch(GAS_URL, { method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'deleteMember', targetName:name}) }).then(()=>{ alert("å‰Šé™¤ã—ã¾ã—ãŸ"); location.reload(); });
             }
        }
        function editReport(rowIndex) {
            const row = allData.find(r => r[r.length-1] == rowIndex);
            if(!row) return;
            const d = new Date(row[0]);
            document.getElementById('report-date').value = `${d.getFullYear()}-${('0'+(d.getMonth()+1)).slice(-2)}-${('0'+d.getDate()).slice(-2)}`;
            const r = document.querySelector(`#name-radios input[value="${row[1]}"]`); if(r) r.checked = true;
            const c = document.querySelector(`input[name="condition"][value="${row[2]}"]`); if(c) c.checked = true;
            document.getElementById('progress').value = row[3];
            document.getElementById('tomorrow').value = row[4];
            document.getElementById('comment').value = row[5];
            currentEditingFileUrl = row[7];
            isEditing = true; editingRowIndex = rowIndex;
            document.getElementById('page-title').innerText = "ä¿®æ­£ãƒ»æ›´æ–°";
            const btn = document.getElementById('submit-btn'); btn.innerText = "æ›´æ–°"; btn.classList.add('update-mode');
            document.getElementById('cancel-edit-btn').style.display = 'block';
            document.getElementById('form-container').classList.add('editing');
            switchTab('input');
        }

        function toggleMenu() { document.querySelector('.sidebar').classList.toggle('active'); }
        document.querySelectorAll('.menu-btn').forEach(btn => btn.addEventListener('click', ()=>{ if(window.innerWidth<=768) document.querySelector('.sidebar').classList.remove('active'); }));
    </script>
</body>
</html>
